<!doctype html>
<!--
................................................ ..........................._,-~"¯¯"~-,
.................................................. ................__„-~"¯¯:::,-~~-,_::::"-
.................................................. ..........„~"¯::::::::::::::"::::::::::::::::::::::\
.................................................. .__„„„-"::::::::::::::::::::::::::::::::::::::::::::::"~-,
..........................................__-~"::,-':::::::::::::::::::::::::::::::::::::::::::::::::::::::: ::::~-,
..........................._______~"___-~"::::::::::::::::::::::::::::::::::::::::::::: ::: :: :::::::::::"-,
......................,~"::::::::::::::¯¯::::::::: ::::::::::::::::::::::::: :::::::::::::::::::::::::::::::::::::::::,: |
....................:/:::::::::::::::::__-~":::::::::::::::::::::::::::::::::::::::::::::::::_,-~":'\'-,:\:|:\|::\|\::\:|
...................,'::::::::,-~~"~"_::',::|::::::::::::::::::::::::::::::::::: :: :::,~ ':\'-,::',"-\::'':"::::::::\|:|/
..............._,-'"~----":::/,~"¯"-:|::|::|:::::::::::::::::::::::::::::::::::,~"::\'-,:\;;'-';;;;;;;;;;;,-'::\::|/
............,-'::::::::::::::::'-\~"O¯_/::,'::|:::::::::::::::::::::::::::::::::,-',::\'-,:|::";;;;;;;;;;;;,-':\:'-,::\
............|:::::::::::::::::-,_'~'::::,-'::,':::::::::::::::::::::::::::::,-':\'-,:\'-,';;';;;;;;;;;;;;;,-':\:::'\-,|''
............|::,-~"::::::::::::::"~~":::,-'::::::::::::::::::::::::_,-~':\'-,|:"'";;;;;;;;;;;;;;,-'¯::'-,:',\|
.........../::/::::::::::::::::::::::::::::::::::::::::::::_,„-~"¯\:\'-,|;''-';;;;;;;;;;;;;;;;;;,-'--,::\-:\:\|
........./::::|:::::::::::::::::::::::::::::::::::::::::,-';;'-';;;;',/;\/;;;;;;;;;;;;;;;;;;;;,-,|:::\-,:|\|..\|
......./:::::::\:::::::::::::::::::::::::::::::::::::,-';;;;;;;;;;;;;;;;;;;;;;;;;;;,-~'''("-,\:::|\:|::''
......,':::::::,'::::::::::::::::::::::::::::::::: :,-'/;;;;;;;;;;;;;;;;;;;;;;;;;,--'::::::/"~'
.....,'::::::::|:::::::::::::::::::::::::::::,„-~"::|;;;;;;;;;;;;;;;;;;;;;,-'::::::::,'::::/
..../:::::::::|:::::::::::::„---~~""¯¯¯::',:::::,';;;;;;;;;;;;;;;;;;;,'::::::::: :: |_,-'
..,'::::::::::::",:,-~"¯::::::::"-,::::::::::|:::/;;;;;;;;;;;;;;;;;;;,':::::::|::::,'
./:::::::::::::::|:::::::::::::::::::"-,:::::::\:::|¯¯¯"""~-,~,_/::::::::,':::/
::::::::::::::::::::::::::::::::::::::"~-,_::|::\: : : : : : |: : \::::::::/:/
::::::::::::::::::::::::::::::",:::::::::::::"-':::\: : : : : : |: : :\::::::\ I'm A T-rex Mother Fucker!!!!!!!!!!!!!!!!
::::::::::::::::::::::::::::::::",:::::::::::::: ::::\: : : : : : \: : : |:::::;;\
::::::::::::::::::"-,:::::::::::::::",:::::::::::::::/|\ ,: : : : : : : |::::,'/|::::|
:::::::::::::::::::::"-,:::::::::::::::"-,_::::::::::\|:/|,: : : : : : : |::: |'-,/|:::|
::::::::::::::::::::::::"~-,_::::::::::::::"~-,_:::"-,/|/\::::::::::: \::: \"-/|::|
:::::::::::::::::::::::::::::::"~-,__:::::::::::',"-,:::"_|/\:|\: : : : \::\":/|\|
::::::::::::::::::::::::::::::::::::::::"~-,_:::::\:::\:::"~/_:|:|\: : : '-,\::"::,'\
:::::::::::::::::::::::::::::::::::::::::::::::"-,_:'-,::\:::::::"-,|:||\,-, : '-,\:::|-'-„
:::::::::::::::::::::::::::::::::::::::::::::::::: ::,-,'"-:"~,:::::"/_/::|-/\--';;\:::/: ||\-,
:::::::::::::::::::::::::::::::::::::::::::::::::: :/...'-,::::::"~„::::"-,/_:|:/\:/|/|/|_/:|
:::::::::::::::::::::::::::::::::::::::::::::::::: |......"-,::::::::"~-:::::""~~~"¯:::|
:::::::::::::::::::::::::::::::::::::::::::::::::: |........."-,_::::::::::::::::::::::::::::/
:::::::::::::::::::::::::::::::::::::::::::::::::\ .............."~--„_____„„-~~"
-->
<html>
<head>
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<title>Artisanal Javascript</title>
<link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,300">
<link rel="shortcut icon" href="./images/favicon.ico">
<link rel="stylesheet" href="./styles/all.css">
<style>
.section { display: none; }
.loading {
    background: url(../images/loading.gif) center no-repeat;
    height: 100vh;
    width: 100vw;
}
</style>
</head>

<body>
<div class="page-wrapper">
    <div class="loading"></div>
</div>
<div id="panel1" class="section">
    <h1>Artisanal Javascript</h1>
    <p>Artisanal Javascript is organically produced, locally grown, chemical free
    source code, made the way nature intended. It is 100% gluten free, and contains
    no trans fats, dietary sugars, or GMOs. Code that is 100% paleo and vegan
    friendly.</p>
</div>

<div id="panel2" class="container section">
    <h3>Completely Organic</h3>
    <div>
    <p>Our in-house brogrammers arrange every bit by hand, crafting them from local,
    sustainable ones and zeros. They are members of, and practice, humane source
    coding under the guidelines of the Responsible Programmers Guild, which promotes
    responsibility and sustainability in the craft. Everything is done by hand, so
    every keystroke is unique.</p>
    </div>
    <img src="./images/honey.jpg" alt="" width="600" height="399">
</div>

<div id="panel3" class="hero-unit hero-unit-bordered section">
    <h1>Painstakingly measured</h1>
</div>

<div id="panel4" class="container section">
    <h3>Eliminate Code Smells</h3>
    <div class="row">
        <div class="col-sm-6 col-sm-offset-3">
            <p>After it is written, our source code is cured in smoked hickory
            for 72 hours then aged in oak barrels for 40 days, resulting a fine
            aroma you won't find anywhere else.</p>
        </div>
    </div>
</div>

<div id="panel5" class="hero-unit section">
    <h1>We haven't shaven in years.
    <br class="hidden-phone">
    Our beards are legendary.</h1>
</div>

<div id="panel6" class="container section">
    <img width="600" height="400" alt="" src="./images/tradition.jpg"/>
    <h3>Tradition</h3>
    <p>Our master codesmiths practice the time-honored traditions handed down
    through centuries since the first Javascript was written out by hand on
    parchment in the mid 15th century. We protect the historic code review
    process developed by Da Vinci himself near the end of that century, and
    commit to only the finest custom-built repositories imported from Italy.</p>
</div>

<span id="panel7" class="section">Hand-minified, with an eye for detail.</span>

<div id="footer" class="section">
    <a class="brand" href="#">Artisanal Javascript</a>
    <a href="https://github.com/letsgetrandy/brototype">Built for you, Bro</a>
    <div class="col-sm-3">
        <!-- <h6>Chicago, IL</h6> -->
        <div class="address">
            <a href="mailto:randy@artisanaljs.com">randy@artisanaljs.com</a>
        </div>
    </div>
</div>

<script src="./scripts/jquery-1.10.2.min.js"></script>
<!-- <script src="/scripts/vendor.js"></script> -->
<script src="./scripts/dicss.js"></script>
<script src="./scripts/brototype.js"></script>
<script src="./scripts/browser.js"></script>
<script type="text/babel">

class Site {
    constructor() {
        this.wrap('#panel1', 'section.header-10-sub.bg-midnight-blue div div.container div.hero-unit');
        this.wrap('#panel2', 'section.organic div');
        this.wrap('#panel3', 'section.measured.bg-midnight-blue.custom-bg div div.container');
        this.wrap('#panel4', 'section.wideload div');
        this.wrap('#panel5', 'section.measured.bg-midnight-blue.p5 div div.container');
        this.wrap('#panel6', 'section.wideload div');
        this.wrap('#panel6 p', 'div.row div.col-sm-6.col-sm-offset-3');
        this.wrap('#panel7', 'section.truckerhat div.container');
        this.wrap('#footer a+a', 'div.col-sm-7 div.additional-links');
        this.wrap('#footer a', 'div.col-sm-2');
        this.wrap('#footer', 'footer.big-rimmed-eyeglasses div.container');

        var section,
            wrapper = document.querySelector('.page-wrapper');
        
        // section.insertBefore(this.make('div.background'), document.querySelector('section div'));
        this.insertBefore('div.background', 'section div');
        this.insertBefore('div#bgVideo.background', 'section.p5 div');

        while (section = document.querySelector('.page-wrapper + section, .page-wrapper + footer')) {
            wrapper.appendChild(section);
        }

        this.dicss();

        document.querySelector('.loading').remove();

        var videobackground = new BackgroundVideo($('#bgVideo'), {
            "align" : "centerXY",
            "path" : "video/",
            "width": 1280,
            "height": 720,
            "filename" : "preview",
            "types" : ['mp4', 'ogg', 'webm']
        });


        // Sections height & scrolling
        $(window).resize(function() {
            var sH = window.innerHeight;
            $('section.header-10-sub').css('height', (sH - $('header').outerHeight()) + 'px');
        });        

        new Parallax('.header-10-sub');
        new Parallax('.measured');

        var fadein = new FadeIn();
        fadein.register('.wideload');
        fadein.register('.organic');
        $(window).resize();


        // // Ani screen
        // (function(el) {
        //     $('img:first-child', el).css('left', '-29.7%');

        //     $(window).scroll(function() {
        //         if (!el.hasClass('ani-processed')) {
        //             if ($(window).scrollTop() >= el.data('scrollPos')) {
        //                 el.addClass('ani-processed');
        //                 $('img:first-child', el).animate({
        //                     left : 0
        //                 }, 500);
        //             }
        //         }
        //     });
        // })($('.screen'));

    }
    make(selector) {
        var classes = selector.split('.'),
            tag = classes.shift(),
            ids = tag.split('#'),
            el = document.createElement(ids.shift());
        if (ids.length) {
            el.setAttribute('id', ids[0]);
        }
        if (classes.length) {
            el.setAttribute('class', classes.join(' '));
        }
        return el;
    }
    
    wrap(element, selector) {
        var tags = selector.split(/\s+/);
        if (element.constructor === String) {
            element = document.querySelector(element);
        }
        while(tags.length) {
            var tag = tags.pop(),
                el = this.make(tag);
            element.parentElement.insertBefore(el, element);
            el.appendChild(element);
            element = el;
        }
    }
    
    insertBefore(tag, selector) {
        var after = document.querySelector(selector);
        after.parentElement.insertBefore(this.make(tag), after);
    }

    dicss() {

        DICSS.putIn('.section', {
            "display": "block"
        });

        DICSS.putIn('body > div, footer', 'display: block;');

        DICSS.putIn('section', {
            "display": "table",
            "width": "100%"
        });

        DICSS.putIn('section > div', {
            "display": "table-cell",
            "vertical-align": "middle",
            "margin-top": "0",
            "margin-bottom": "0",
            "float": "none"
        });

        DICSS.putIn('.fade-in', {
            "opacity": "0",
            "transition": "opacity 1000ms"
        });

        DICSS.putIn('.fade-in.shown', {
            "opacity": "1"
        });
    }
}

class FadeIn {
    constructor(shift=200) {
        this.shift = shift;
        this.els = [];
        this.registerListeners();
    }
    register(selector) {
        var el, els = document.querySelectorAll(selector);
        for (var i = 0; i < els.length; i++) {
            el = els[i];
            el.className += ' fade-in';
            this.els.push(el);
        }
    }
    registerListeners() {
        var self = this;
        $(window).resize(() => {
            for (var i = 0; i < this.els.length; i++) {
                var el = this.els[i];
                if (!/\bshown\b/.test(el.className)) {
                    el.dataset['scrollpos'] = el.offsetTop - window.innerHeight + this.shift;
                }
            }
        }).scroll(() => {
            var el, i = 0;
            while (i < this.els.length) {
                el = this.els[i];
                if (!/\bshown\b/.test(el.className)) {
                    if (window.scrollY >= el.dataset.scrollpos) {
                        el.className += ' shown';
                        this.els.splice(i, 1);
                    } else {
                        i++;
                    }
                }
            }
        });
    }
}

class BackgroundVideo {
    constructor(el, options) {
        this.el = el;
        this.settings = {
            videoid: "video_background",
            autoplay: true,
            loop: true,
            preload: true
        }
        for (var key in options) {
            this.settings[key] = options[key];
        }
        this.buildVideo();
        var self = this;
        $(window).resize(function() {
            self.setProportion();
        });
        this.$videoEl.bind('ended', function(){
            self.play();
        });
    }

    buildVideo() {
        var html = '',
            preloadString = this.settings.preload ? 'preload="auto"' : '',
            autoplayString = this.settings.autoplay ? 'autoplay="autoplay"' : '',
            loopString = this.settings.loop ? 'loop="true"' : '';

        html = `<video id="${this.settings.videoid}" ${preloadString} ${autoplayString} ${loopString}`;

        if (this.settings.poster) {
            html += ' poster="' + this.settings.poster + '" ';
        }

        html += 'style="display:none;position:fixed;top:0;left:0;bottom:0;right:0;z-index:-100;width:100%;height:100%;">';
        for (var i = 0; i < this.settings.types.length; i++) {
            html += `<source src="${this.settings.path}${this.settings.filename}.${this.settings.types[i]}" type="video/${this.settings.types[i]}">`;
        }
        html += 'bgvideo</video>';
        this.el.prepend(html);
        this.videoEl = document.getElementById(this.settings.videoid);
        this.$videoEl = $(this.videoEl);
        this.$videoEl.fadeIn(2000);
        this.setProportion();
    }

    setProportion() {
        var proportion = this.getProportion();
        this.$videoEl.width(proportion * this.settings.width);
        this.$videoEl.height(proportion * this.settings.height);

        if (typeof this.settings.align !== 'undefined') {
            this.centerVideo();
        }
    }

    getProportion() {
        var windowWidth = $(window).width(),
            windowHeight = $(window).height(),
            windowProportion = windowWidth / windowHeight,
            origProportion = this.settings.width / this.settings.height,
            proportion = windowHeight / this.settings.height;
        if (windowProportion >= origProportion) {
            proportion = windowWidth / this.settings.width;
        }
        return proportion;
    }

    centerVideo() {
        var centerX = (($(window).width() >> 1) - (this.$videoEl.width() >> 1)) | 0;
        var centerY = (($(window).height() >> 1) - (this.$videoEl.height() >> 1)) | 0;

        if (this.settings.align === 'centerXY') {
            this.$videoEl.css({ 'left': centerX, 'top': centerY });
            return;
        }
        if (this.settings.align === 'centerX') {
            this.$videoEl.css('left', centerX);
            return;
        }
        if (this.settings.align === 'centerY') {
            this.$videoEl.css('top', centerY);
            return;
        }
    }
}

class Parallax {
    constructor(selector, xpos='50%', speed=0.3) {
        this.el = document.querySelector(selector);
        this.firstTop = this.el.offsetTop;
        this.xpos = xpos;
        this.speed = speed;

        $(window)
            .bind('scroll', () => { this.update(); })
            .resize(() => { this.update(); });
        this.update();
    }

    update() {
        var pos = window.scrollY,
            top = this.el.offsetTop,
            height = this.el.offsetHeight,
            windowHeight = $(window).height();

        // Check if totally above or totally below viewport
        if (top + height < pos || top > pos + windowHeight) {
            return;
        }

        this.el.style.backgroundPosition = this.xpos + ' ' + Math.round((this.firstTop - pos) * this.speed) + "px";
    }       
}

setTimeout(function() { new Site(); }, 550);

</script>
</body>
</html>
